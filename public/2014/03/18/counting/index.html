
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>count() ain't nothing but a number - smknstd.io</title>
  <meta name="author" content="smknstd">

  
  <meta name="description" content="Compter des données ou en estimer la cardinalité est une opération dont les applications sont très variées. Tellement variées que tout le monde ou &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.smknstd.io/2014/03/18/counting/">
  <link href="/images/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feedpress.me/smknstd" rel="alternate" title="smknstd.io" type="application/atom+xml">
  <script type="text/javascript" src="//use.typekit.net/oqc4yak.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript">
function show_new() {
	var j=0;
    var chila = document.getElementById("blog-archives").children;
	for(var i = 0; i < chila.length; i++) {
			var ch = chila[i].getElementsByTagName('h1')[0];
		    var lien = ch.getElementsByTagName('a')[0].getAttribute("href");
		    mytab = lien.split("/");
		    var parsedDate = new Date(parseInt(mytab[1]), parseInt(mytab[2])-1, parseInt(mytab[3]), 0, 0, 0, 0);
		    var today = new Date();
		    var diffDays = Math.floor((today - parsedDate)/(1000*60*60*24));
		    if(diffDays<45){
		    	j++;
		        ch.innerHTML=chila[i].getElementsByTagName('h1')[0].innerHTML+"<div id='new'>NEW</div>";
		    }else{
		    	// comme les articles sont ordonnées chronologiquement on peut s'arreter de chercher au premier article de plus de 45 jours trouvé 
		    	break;
		    }

	}
	console.log("[function show_new] " + j +" articles de moins de 45 jours (rajout de l'etiquette NEW)");
}
</script>

  
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-5215670-9']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>


</head>

<body onload="show_new()"   >
  <header role="banner">  <div id="logo"><a href="/"><img src="/images/logo.png" alt="logo" /></a></div>
  <div id="legend">{type: "web log", localhost: "Paris", about: "trapped all day, got my cheese and an indexed key"}</div>

</header>
  <nav role="navigation">
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    <div id="archive_header">
    
      <h2 class="entry-title">Count() Ain't Nothing but a Number</h2>
    
    </div>
  </header>
  <header>
    <div id="archive_header">
    
      <h3 class="meta">
        








  


<time datetime="2014-03-18T22:31:00+01:00" pubdate data-updated="true">Mar 18<span>th</span>, 2014</time>
      </h3>
    
    </div>
  </header>


<div class="entry-content"><p>Compter des données ou en estimer la cardinalité est une opération dont les applications sont très variées. Tellement variées que tout le monde ou presque a besoin de le faire à un moment ou à un autre. Au fil de mes expériences, j&#8217;ai pu observer de nombreux moyens de le faire dans des contextes et avec des outils variés. Pas tout le monde n&#8217;a l&#8217;ambition de se revendique &#8220;Data scientist&#8221;, mais j&#8217;ai vu des gens faire preuve de créativité avec les moyens mis à leur disposition et surtout leur niveau de connaissance. Bien sûr le volume de données reste un enjeu majeur. Cet article est une sorte de réflexion générale.</p>

<h1>SQL</h1>

<p>Lorsque les données sont bien sagement rangées dans un SGBDR (en état de marche), les possibilités et surtout l&#8217;accessibilité du langage SQL n&#8217;échappent à personne. Count(*), clause Where, Group By, rien de plus simple à mettre en œuvre. Quand les choses se compliquent, la palette d&#8217;outils des principaux systèmes répond aux cas d&#8217;utilisation les plus tordus (DISTINCT, EXISTS, HAVING, etc).</p>

<p><img src="/images/mysql-count.png" title="mysql count() group by" alt="mysql" /></p>

<p>Avec beaucoup de données, viennent les problèmes. Un des outils intéressant concernant le comptage et la cardinalité et parfois méconnu est l&#8217;index <a href="http://en.wikipedia.org/wiki/Bitmap_index">bitmap</a>. Si vous ne le connaissez pas, je vous encourage à étudier son principe de fonctionnement. Ci dessous un <a href="http://en.wikipedia.org/wiki/Query_plan">plan d&#8217;execution</a> mettant à contribution un index bitmap sous Oracle 11g:</p>

<p><img src="/images/bitmap.png" title="bitmap plan" alt="bitmap" /></p>

<p>Dans la famille des systèmes relationnels, une autre approche prometteuse souhaite répondre à la problématique du volume de données: les <a href="http://en.wikipedia.org/wiki/Vectorwise"> bases vectorielles</a>. Basé sur une orientation <a href="http://en.wikipedia.org/wiki/Column-oriented_DBMS">colonne</a> tout en gardant la commodité de l&#8217;interrogation d&#8217;un modèle relationnel, cette base promet des performances incroyables. Gardons à l&#8217;esprit que le gain se fait bien sûr au détriment de quelques sacrifices comme les contraintes ou le principe de transaction. Privé de polyvalence, elles sont exclues de nombreux domaines d&#8217;applications opérationnels.</p>

<h1>Non-hacker</h1>

<p>Selon mon expérience, le problème est souvent résolu tant bien que mal avec un tableur directement sur une station de travail. Personnellement, j&#8217;appelle ça du bricolage, mais j&#8217;avoue être parfois impressionné par la créativité mise en œuvre. Dans le meilleur des cas on a recours à un <a href="http://en.wikipedia.org/wiki/Pivot_table">tableau croisé dynamique</a>. La mise en forme des données nécessite souvent un travail d’orfèvre. Heureusement, il existe au moins un <a href="http://stackoverflow.com/questions/526921/why-is-there-still-a-row-limit-in-microsoft-excel">frein</a> à l&#8217;utilisation parfois désastreuse de ce genre d&#8217;utilisations quand les besoins deviennent récurrents.</p>

<h1>Hacker</h1>

<p>Comme souvent, UNIX a une réponse simple, efficace et robuste à la question. Pourquoi perdre du temps avec de nouveaux outils quand ceux qu&#8217;on a déjà conviennent ? La puissance du modèle UNIX fournit beaucoup de souplesse et permet d&#8217;effectuer de nombreuses opérations en cumulant successivement plusieurs fonctionnalités grâce à l&#8217;utilisation du <a href="http://doc.cat-v.org/unix/pipes/">pipe</a>. Pour ne citer que quelques-uns de ces indispensables outils:</p>

<ul>
<li>sort</li>
<li>uniq</li>
<li>grep</li>
<li>wc</li>
<li>join</li>
<li>awk</li>
<li>cut</li>
</ul>


<p>En plus d&#8217;être bien documentés, open source et faciles à utiliser, ces outils sont généralement <a href="http://lists.freebsd.org/pipermail/freebsd-current/2010-August/019310.html">très</a> <a href="http://en.wikipedia.org/wiki/Merge_sort">efficients</a>.</p>

<p>Une fois qu&#8217;on s&#8217;y est habitué, il est difficile de s&#8217;en passer. J&#8217;ai découvert que même lorsqu&#8217;on ne disposait que d&#8217;un environnement Windows, il est possible de profiter de quelques-uns de ces outils grâce à certaines solutions comme <a href="http://en.wikipedia.org/wiki/MKS_Toolkit">MKStoolkit</a> ou <a href="http://en.wikipedia.org/wiki/Cygwin">cygwin</a>. Précisons que c&#8217;est une utilisation dégradée par rapport aux outils originaux, car selon mon expérience la qualité du portage et de l&#8217;implémentation laissent largement à désirer.</p>

<p><img src="/images/mkstoolkit.png" title="nutcracker" alt="mkstoolkit" /></p>

<p>Ci-dessous, vous trouverez un exemple d&#8217;implémentation d&#8217;une opération habituelle de manipulation et de comptage sur des fichiers avec un outil traditionnel d&#8217;<a href="http://en.wikipedia.org/wiki/Extract,_transform,_load">ETL</a>. On peut constater que la logique d&#8217;élaboration d&#8217;un flux de données au travers de l&#8217;interface graphique dite &#8220;conviviale&#8221;, s&#8217;inspire largement du modèle Unix. Les données sont traitées successivement dans des opérations spécifiques, et on peut facilement assimiler les liens entre ces fonctions au &#8220;pipe&#8221;.</p>

<p><img src="/images/datastage.png" title="datastage" alt="datastage" /></p>

<p>Pour des besoins bien spécifiques, il existe des librairies dédiées dans la plupart des langages de programmation courants. On peut citer, <a href="http://pandas.pydata.org/">panda</a>, un framework de traitement en mémoire facile à mettre en œuvre même sur une station de travail et qui fait beaucoup parler de lui.</p>

<h1>BIG DATA</h1>

<p>Quand les volumes dépassent ce que savant faire les solutions décrient plus haut, pour faire simple: vous êtes êtes mal barré.</p>

<p>Concernant notre problématique de comptage et de cardinalité et la hype NOSQL, je n&#8217;ai malheureusement pas grand chose à dire à ce sujet car je ne le connais pas bien. Toutefois deux outils ont attiré mon attention:</p>

<ul>
<li>l’implémentation des <a href="http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/">&#8220;bitsets&#8221;</a> dans Redis.</li>
<li>Bloom filters/Hyper log log/count min : une famille d’algorithme qui semble avoir trouvé beaucoup d’écho dans la communauté scientifique, au vue des nombreux papiers de recherche qui peuplent les résultats des moteurs de recherche.</li>
</ul>


<p>Même si je ne me sens pas bien concerné par leur utilisation, j&#8217;avoue que leur philosophie parait extrêmement intéressante et s&#8217;annoncent comme des outils prometteurs et utiles dans de nombreux domaines d&#8217;application. Notez bien qu&#8217;on peut facilement tester ces outils grâces à la mise à disposition de librairies. J&#8217;ai pour ma part fait quelques essais très facilement avec une implémentation en <a href="https://github.com/addthis/stream-lib">java</a>.</p>

<p><img src="/images/count-bundesliga.png" title="count unixVSbloom" alt="count" /></p>

<h3>Ressources</h3>

<ul>
<li><a href="http://www.football-data.co.uk/germanym.php">données</a> du championnat de football allemand que j&#8217;ai utilisé</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">smknstd</span></span>

      








  


<time datetime="2014-03-18T22:31:00+01:00" pubdate data-updated="true">Mar 18<span>th</span>, 2014</time>
      


    </p>
    <div id="archive_header2">
      <div id="archive_header3">
      
        <a class="basic-alignment left" href="/2013/11/30/vimvssublime/" title="Previous Post: vim VS Sublime Text: ajout d'un numéro de séquence">&laquo; vim VS Sublime Text: ajout d'un numéro de séquence</a>
      
      
        <a class="basic-alignment right" href="/2014/04/27/command-lines-percy/" title="Next Post: Mes outils en ligne de commande préférés">Mes outils en ligne de commande préférés &raquo;</a>
      
      </div>
    </div>
  </footer>
</article>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  2014 - smknstd -
  <span class="credit">designed with <a href="http://octopress.org">Octopress</a> and hosted by <a href="http://heroku.com">Heroku</a></span>
</p>

</footer>
  












</body>
</html>
